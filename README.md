# О ветке
В данной ветке находятся исходники учебного проекта *Bitflix* перестроенном на MVC фреймворке с нуля (PHP 7.4)

# Зависимости проекта
* `Autoloader` (from composer)

# Как запустить
* Скачать содержимое ветки себе
* В корне исполнить команду `composer install`
* Возможно потребуется также исполнить команду `composer dump-autoload -o`
* Запустить веб-сервер

# Структура
В папке `bitflix` лежат все исходники проекта:
* `config` - для конфигурационных файлов
* `controllers`- для контролерров страничек
* `core` - для базовых классов MVC фреймворка
* `database` - для классов, которые обёртывают вызовы к базе данных
* `models` - для моделей бизнес-логики
* `views` - для вёрстки

В папке `public` находится entry-point сайта `index.php` и статические ассеты

Стоит отметить, что с помощью конфигурационных `.htaccess` файлов запросы к корню веб-сайта перенаправляются на `public/index.php` (пользователю сайта доступно только содержимое папки `public`).

# MVC-фреймворк
![mvc](https://user-images.githubusercontent.com/21146483/149455745-199f0719-7372-4968-8c4f-b585125fa229.jpg)

Самым главный классом является класс-одиночка `Application`, который выступает в роли инстанса работы веб-сайта.
Он содержит в себе такие объекты классов, как:
* `Router` - реализует логику парсинга строки запроса и перенаправляет их в нужные обработчики (контроллеры)
* `Request` - работает с данными о запросе и достаёт данные из запроса
* `Response` - сущность ответа от сервера (для перенаправлений по сайту и установки кода статуса ответа)
* `Controller` - базовый класс для обеспечивания работы страниц (содержит метод `render` и имя леяута)
* `Database` - простая обёртка над `mysqli` драйвером для подключения и отсылки SQL запросов к СУБД
* `Config` - менеджер конфигурационных файлов (подгружает все файлы по выданному ему пути и запихивает их в словари)
* `View` - класс, реализующий базовую отрисовку страниц на основе статического метода-шаблонизатора
* `ServiceContainer` - контейнер для сервисов, которые предоставляют модели бизнес-логики контроллерам
* Базовый класс `модели` пока что не реализован

# Bitflix
![bitflix](https://user-images.githubusercontent.com/21146483/149459288-675995cd-0e2b-4e1c-b275-b2ca3666d92a.png)

* `Movie` - данные о фильме
* `MovieRepositoryInterface` - интерфейс для получения данных о фильмах
* `MysqlMovieRepository` - класс, реализующий интерфейс выше, для получения данных о фильмах из MySQL
* `MovieService` - сервис, предоставляющий данные контроллеру о фильмах в нужном виде
* `SiteController` - контроллер сайта, имеющий методы для обработки запросов к каждой имеющейся странице сайта

В `index.php` происходит настройка `Application`, `ServiceContainer`, подключается `autoloader`, регистрируются обработчики для Роутера по различным путям

# Работа сайта
При заходе на сайт пользователь отправляет запрос на сервер к `public/index.php` файлу, который вызывает метод `run` ранее созданного и настроенного объекта синглтон-класса `Application`.

Дальше будет выводиться результат метода `handle` объекта класса `Router` уже в виде самой вёрстки страницы. Данный метод помощью сущности `Request` получает `REQUEST_URI`, полирует до нужного состояния и соотносит со словарём путей. 

Если в словаре по пути имеется обработчик в виде контроллера, то создаётся его объект и вызывается соответствующий метод контроллера. Методы контроллера устроены по принципу: получение нужных данных из конфигурационных файлов или из сервисов, затем вызывается метод `render` базового класса с аргументами в виде пути к view-файлу и нужными данными.

Дальше с помощью класса `View` и шаблонизатора происходит вывод всей страницы по кускам в буфер. В итоге, результат из буфера получает обратно метод `run` и выводит его пользователю в виде готовой страницы.
